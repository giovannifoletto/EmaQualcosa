let idList = {
    "el1": {
        "id": "#Rimini",
        "name": "Rimini",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato."
    },
    "el2": {
        "id": "#Rimini-ForliCesena",
        "name": "Rimini Forlì Cesena",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato.",
        "divisione": false,
        "regionale": true
    },
    "el3": {
        "id": "#Ravenna",
        "name": "Ravenna",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato.",
        "divisione": false,
        "regionale": true
    },
    "el4": {
        "id": "#Ferrara",
        "name": "Ferrara",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato.",
        "divisione": false,
        "regionale": true
    },
    "el5": {
        "id": "#Bologna",
        "name": "Bologna",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato.",
        "divisione": false,
        "regionale": true
    },
    "el6": {
        "id": "#Modena",
        "name": "Modena",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato.",
        "divisione": false,
        "regionale": true
    },
    "el7": {
        "id": "#ReggioEmilia",
        "name": "Reggio Emilia",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato.",
        "divisione": false,
        "regionale": true
    },
    "el8": {
        "id": "#Parma",
        "name": "Parma",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato.",
        "divisione": false,
        "regionale": true
    },
    "el9": {
        "id": "#Piacenza",
        "name": "Piacenza",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato.",
        "divisione": false,
        "regionale": true
    },
    "el10": {
        "id": "#Pavia",
        "name": "Pavia",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato.",
        "divisione": false,
        "regionale": true
    },
    "el11": {
        "id": "#Milano-Lodi",
        "name": "Milano e Lodi",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato.",
        "divisione": false,
        "regionale": true
    },
    "el12": {
        "id": "#Cremona-Mantova",
        "name": "Cremona e Mantova",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato.",
        "divisione": false,
        "regionale": true
    },
    "el13": {
        "id": "#Brescia",
        "name": "Brescia",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato.",
        "divisione": false,
        "regionale": true
    },
    "el14": {
        "id": "#Bergamo",
        "name": "Bergamo",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato.",
        "divisione": false,
        "regionale": true
    },
    "el15": {
        "id": "#Como-Lecco-MonzaBrianza",
        "name": "Como, Lecco e Monza-Brianza",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato.",
        "divisione": false,
        "regionale": true
    },
    "el16": {
        "id": "#Varese",
        "name": "Varese",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato.",
        "divisione": false,
        "regionale": true
    },
    "el17": {
        "id": "#Sondrio",
        "name": "Sondrio",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato.",
        "divisione": false,
        "regionale": true
    },
    "el18": {
        "id": "#Bolzano",
        "name": "Bolzano",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato.",
        "divisione": false,
        "regionale": true
    },
    "el19": {
        "id": "#Trento",
        "name": "Trento",
        "info": "",
        "linkAspiranti": "https://docs.google.com/forms/d/e/1FAIpQLSeRG1rvz0OPpsVuUMR7JGXAw3XujX3E7jsz1TwYvTeerE1K8w/viewform?usp=sf_link",
        "linkDonatori": "https://www.ulssfeltre.veneto.it/AriannaCup/PortaleCittadinoWeb/WebForms/ScegliPrenotazione.aspx",
        "divisione": true
    },
    "el20": {
        "id": "#Verona",
        "name": "Verona",
        "info": "Una volta compilato il modulo verrai ricontattato via mail",
        "linkAspiranti": "fidasverona.it/it/vorrei-diventare-donatore",
        "linkDonatori": "https://www.fidasverona.it/it/vorrei-prenotare-la-donazione",
        "divisione": true
    },
    "el21": {
        "id": "#Vicenza",
        "name": "Vicenza",
        "info": "",
        "linkAspiranti": "https://docs.google.com/forms/d/e/1FAIpQLSeN5Po_FS4or8FfKS2u-mjCZAbRu1TEz-tBEtvceLJUkj3nWQ/viewform",
        "linkDonatori": "https://www.fidasverona.it/it/vorrei-prenotare-la-donazione",
        "divisione": true
    },
    "el22": {
        "id": "#Padova",
        "name": "Padova",
        "info": "",
        "linkAspiranti": "https://form.jotform.com/212316458894363",
        "linkDonatori": "https://docs.google.com/forms/d/e/1FAIpQLSeGcD5qFaPXhUjzRZtD3A1cNCQMNxlFngAOq-rmAIx6cF-Pfw/viewform?usp=sf_link",
        "divisione": true
    },
    "el23": {
        "id": "#Rovigo",
        "name": "Rovigo",
        "info": "",
        "linkAspiranti": "https://docs.google.com/forms/d/e/1FAIpQLSet0hVtdq_CdZYyvZFUDtj3sOWGd7-U1aIf4K3Ppd0KftW49A/viewform?usp=sf_link",
        "linkDonatori": "https://docs.google.com/forms/d/e/1FAIpQLSet0hVtdq_CdZYyvZFUDtj3sOWGd7-U1aIf4K3Ppd0KftW49A/viewform?usp=sf_link",
        "divisione": true
    },
    "el24": {
        "id": "#Treviso",
        "name": "Treviso",
        "info": "",
        "linkAspiranti": "https://docs.google.com/forms/d/e/1FAIpQLSfehHxfzrq8cI8upXafRSYz_tsdHjBrJP_jZqdVZFCMYs7dSg/viewform?usp=sf_link",
        "linkDonatori": "https://docs.google.com/forms/d/e/1FAIpQLSfehHxfzrq8cI8upXafRSYz_tsdHjBrJP_jZqdVZFCMYs7dSg/viewform?usp=sf_link",
        "divisione": true
    },
    "el25": {
        "id": "#Belluno",
        "name": "Belluno",
        "info": "",
        "linkAspirantiFeltre": "https://docs.google.com/forms/d/e/1FAIpQLSeRG1rvz0OPpsVuUMR7JGXAw3XujX3E7jsz1TwYvTeerE1K8w/viewform?usp=sf_link",
        "linkAspirantiBelluno": "https://forms.gle/MTrq66oQVn41xqhD7",
        "linkDonatoriFeltre": "https://www.ulssfeltre.veneto.it/AriannaCup/PortaleCittadinoWeb/WebForms/ScegliPrenotazione.aspx",
        "linkDonatoriBelluno": "https://forms.gle/MTrq66oQVn41xqhD7",
        "divisione": true
    },
    "el26": {
        "id": "#Pordenone",
        "name": "Pordenone",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato.",
        "divisione": false,
        "regionale": true
    },
    "el27": {
        "id": "#Udine",
        "name": "Udine",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato.",
        "divisione": false,
        "regionale": true
    },
    "el28": {
        "id": "#Venezia2",
        "name": "Venezia",
        "info": "",
        "linkDonatori": "https://docs.google.com/forms/d/e/1FAIpQLSdO1FCQRS1d6Scrte0fZwuuCOFK4CQxhh9AJE_tZp-hHF1GvA/viewform?usp=sf_link",
        "linkAspiranti": "https://docs.google.com/forms/d/e/1FAIpQLSdO1FCQRS1d6Scrte0fZwuuCOFK4CQxhh9AJE_tZp-hHF1GvA/viewform?usp=sf_link"
    },
    "el29": {
        "id": "#Venezia1",
        "name": "Venezia",
        "info": "",
        "linkDonatori": "https://docs.google.com/forms/d/e/1FAIpQLSdO1FCQRS1d6Scrte0fZwuuCOFK4CQxhh9AJE_tZp-hHF1GvA/viewform?usp=sf_link",
        "linkAspiranti": "https://docs.google.com/forms/d/e/1FAIpQLSdO1FCQRS1d6Scrte0fZwuuCOFK4CQxhh9AJE_tZp-hHF1GvA/viewform?usp=sf_link"
    },
    "el30": {
        "id": "#Venezia3",
        "name": "Venezia",
        "info": "",
        "linkDonatori": "https://docs.google.com/forms/d/e/1FAIpQLSdO1FCQRS1d6Scrte0fZwuuCOFK4CQxhh9AJE_tZp-hHF1GvA/viewform?usp=sf_link",
        "linkAspiranti": "https://docs.google.com/forms/d/e/1FAIpQLSdO1FCQRS1d6Scrte0fZwuuCOFK4CQxhh9AJE_tZp-hHF1GvA/viewform?usp=sf_link"
    },
    "el31": {
        "id": "#Gorizia2",
        "name": "Gorizia",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato.",
        "divisione": false,
        "regionale": true
    },
    "el32": {
        "id": "#Gorizia",
        "name": "Gorizia",
        "linkDonatori": "https://fidas.it/dona-ora/",
        "linkAspiranti": "https://fidas.it/dona-ora/",
        "info": "Pagina ancora in fase di costruzione. Lascia i tuoi contatti al seguente modulo e sarai ricontattato.",
        "divisione": false,
        "regionale": true
    }
};

function createContent(a) {
    const card = ``
    `<div class="card">
        <div class="card-body">
            <h5 class="card-title">${a.name}</h5>
            <p class="card-text">${a.info}</p>
            <a href="${a.linkDonatori}" class="btn btn-primary">Clicca qui per prenotare la tua donazione!</a>
            <a href="${a.linkAspiranti}" class="btn btn-primary">Clicca qui per diventare donatore!</a>
        </div>
     </div>`
    ``;
    $("#mapContent").html(card);
}

function showPopover(c) {
    let pop;
    if (c.divisione == true) { // BELLUNO to DO
        pop = `<div class="card" id="cards">
        <div class="card-body">
        <h5 class="card-title">${c.name}</h5>
        <!-- <h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6> -->
        <p class="card-text">${c.info}</p>
        </div>
        </div>
        <div>
            <ul class="list-group">
                <li class="list-group-item">
                    <a href="${c.linkAspirantiFeltre}" class="card-link">Clicca per diventare Donatore a Feltre!</a>
                </li>
                <li class="list-group-item">
                    <a href="${c.linkDonatoriFeltre}" class="card-link">Clicca per prenotare la donazione a Feltre!</a>
                </li>
                <li class="list-group-item">
                    <a href="${c.linkAspirantiBelluno}" class="card-link">Clicca per diventare Donatore a Belluno!</a>
                </li>
                <li class="list-group-item">
                    <a href="${c.linkDonatoriBelluno}" class="card-link">Clicca per prenotare la donazione a Belluno!</a>
                </li>
            </ul>
        </div>`;
    } else {
        if (c.regionale == true) {
            pop = `<div class="card" id="cards">
        <div class="card-body">
        <h5 class="card-title">${c.name}</h5>
        <!-- <h6 class="card-subtitle mb-2 text-muted">Card subtitle</h6> -->
        <p class="card-text">${c.info}</p>
        </div>
        </div>
        <div>
            <ul class="list-group">
                <li class="list-group-item">
                    <a href="${c.linkAspiranti}" class="card-link">Clicca per diventare Donatore!</a>
                </li>
                <li class="list-group-item">
                    <a href="${c.linkDonatori}" class="card-link">Clicca per prenotare la donazione!</a>
                </li>
            </ul>
        </div>`;
        } else {
            pop = `<div class="card" id="cards">
            <div class="card-body">
            <h5 class="card-title">${c.name}</h5>
            <h6 class="card-subtitle mb-2 text-muted">Modulo Nazionale</h6>
            <p class="card-text">${c.info}</p>
            </div>
            </div>
            <div>
                <ul class="list-group">
                    <li class="list-group-item">
                        <a href="${c.linkAspiranti}" class="card-link">Clicca per diventare Donatore!</a>
                    </li>
                    <li class="list-group-item">
                        <a href="${c.linkDonatori}" class="card-link">Clicca per prenotare la donazione!</a>
                    </li>
                </ul>
            </div>`;
        }
    }
    $(c.id).popover({
        html: true,
        title: "",
        content: pop
    });
    $(c.id).popover('show');
}

function createHover(a) {
    /*
        Questa funzione serve a gestire gli eventi quando si passa sopra la provincia
        - cambiamento di opacità per il colore della regione
        - funzione popover con timeout ?
    */
    var active;
    $(a.id).hover(
        function() {
            if (a.id != active) {
                $(active).popover('hide');
            }
            active = a.id;
            showPopover(a);
            $(this).css('opacity', '50%');
        },
        function() {
            $(this).css("opacity", "100%");
            if (active == a.id) {
                $(a.id).popover('hide');
            }
        }
    );
}

/*const card = ``
    `<div class="card">
        <div class="card-body">
            <h5 class="card-title">${a.name}</h5>
            <p class="card-text">${a.info}</p>
            <a href="${a.linkDonatori}" class="btn btn-primary">Clicca qui per prenotare la tua donazione!</a>
            <a href="${a.linkAspiranti}" class="btn btn-primary">Clicca qui per diventare donatore!</a>
        </div>
     </div>`
    ``;

        $("#mapContent").html(card);
        */

function createClick(a) {
    let content = "";
    if (a.divisione != true) {
        content = `<div class="card" id="move">
        <div class="card-body">
            <h5 class="card-title">${a.name}</h5>
            <p class="card-text">${a.info}</p>
            <div class="container text-center">
                    <a href="${a.linkDonatori}" class="btn btn-primary" style="margin:1px">Clicca qui per prenotare la tua donazione!</a>
                    <a href="${a.linkAspiranti}" class="btn btn-primary" style="margin:1px">Clicca qui per diventare donatore!</a>
                </div>
            </div>
        </div>
     </div>`;
    } else {
        content = `<div class="card" id="move">
    <div class="card-body">
        <h5 class="card-title">${a.name}</h5>
        <p class="card-text">${a.info}</p>
        <div class="container text-center">
                <a href="${a.linkDonatoriFelte}" class="btn btn-primary" style="margin:1px">Clicca qui per prenotare la tua donazione a Feltre!</a>
                <a href="${a.linkAspirantiFeltre}" class="btn btn-primary" style="margin:1px">Clicca qui per diventare donatore a Feltre!</a>
                <a href="${a.linkDonatoriBelluno}" class="btn btn-primary" style="margin:1px">Clicca qui per prenotare la tua donazione a Belluno!</a>
                <a href="${a.linkDonatoriBelluno}" class="btn btn-primary" style="margin:1px">Clicca qui per diventare donatore a Belluno!</a>
            </div>
        </div>
    </div>
 </div>`;
    }
    $(a.id).click(function() {
        $("#mapContent").html(content);
        $([document.documentElement, document.body]).animate({
            scrollTop: $("#move").offset().top
        }, 1000);
    });
}

// insert event handler for HOVERING in the maps regions
// inserti event handler for CLICK on map region
function createAllHover() {
    for (let key in idList) {
        //console.log(idList[key]);
        createHover(idList[key]);
        createClick(idList[key]);
    }
}

function inizializeInput() {
    var s = "";
    $("#searchBar").keypress(e => {
        if (e.which == 13) {
            eventSubmit(s);
            s = "";
            $("#searchBar").val("");
        } else {
            s += String.fromCharCode(e.which);
        }
    });
}
/*
function findValue(s) {
    $.each(idList, (e) => {
        if (e.name === s) {
            return true;
        } else {
            return false;
        }
    });
}

// funzione per la ricerca
function eventSubmit(s) {

    if (findValue(s) == true) {
        const card = ``
        `<div class="card">
            <div class="card-body">
                <h5 class="card-title">${a.name}</h5>
                <p class="card-text">${a.info}</p>
                <a href="${a.linkDonatori}" class="btn btn-primary">Clicca qui per prenotare la tua donazione!</a>
                <a href="${a.linkAspiranti}" class="btn btn-primary">Clicca qui per diventare donatore!</a>
            </div>
         </div>`
        ``;
        $("#mapContent").html(card);
        $([document.documentElement, document.body]).animate({
            scrollTop: $("#move").offset().top
        }, 1000);
    } else {
        let content = `<div class="card" id="move">
        <div class="card-body">
            <p class="card-text">Non Sono state trovate informazioni per la provincia cercata!</p>
            <p class="card-text">Provare il <a href='https://fidas.it'>sito nazionale</a>.</p>
     </div>`;
        $("#mapContent").html(content);
        $([document.documentElement, document.body]).animate({
            scrollTop: $("#move").offset().top
        }, 1000);
    }
}*/

$(document).ready(() => {
    //console.log("Document ready");
    // Set map width
    var page = $("windows").width();
    $('#svgMap').width(page);
    $('#svgMap').height(page);
    //console.log("Ciao sto eseguendo da index.js");
    inizializeInput();
    createAllHover();
});